#!/bin/bash
# -*- mode: bash; tab-width: 2; -*-
# vim: ts=2 sw=2 ft=bash noet

# source the Nos framework
. /opt/nanobox/nos/common.sh

# initialize Nos with the original arguments
nos_init "$@"

# source common lib, where the helpers are defined
. ${engine_lib_dir}/php.sh

nos_print_process_start "Installing packages"

# install php interpreter
install_runtime

# install php and zend extensions
install_php_extensions

# install apache or nginx
install_webserver

# install composer binary
install_composer

# persist all environment variables 
nos_persist_evars

# configure apache or nginx
configure_webserver

# configure php-fpm settings
configure_php_fpm

# configure php.ini and php extensions' ini files
configure_php

# configure the newrelic monitoring agent
configure_newrelic

# if a composer.json file is present, run composer install
composer_install

exit 0